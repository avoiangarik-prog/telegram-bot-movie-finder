# телеграм бот кино
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackQueryHandler, ContextTypes, CallbackContext
import logging

# Включаем логирование для отладки
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
logger = logging.getLogger(__name__)

# Пример базы данных с фильмами и сериалами
movies_db = {
    'Комедия': ['Тупой и ещё тупее', 'Маска', 'Отпетые мошенники'],
    'Драма': ['Форрест Гамп', 'Зеленая миля', 'Побег из Шоушенка'],
    'Ужасы': ['Сияние', 'Исчезнувшая', 'Заклятие'],
    'Фантастика': ['Звёздные войны', 'Матрица', 'Начало'],
}

# Функция для старта бота
async def start(update: Update, context: CallbackContext) -> None:
    """Отправляет сообщение при запуске команды /start."""
    if update.message:
        await update.message.reply_text('Привет! Я бот, который поможет тебе выбрать фильм или сериал по жанру.')
        await show_genres_menu(update, context)

# Функция для показа меню выбора жанра
async def show_genres_menu(update: Update, context: CallbackContext) -> None:
    """Отображает кнопки с доступными жанрами."""
    keyboard = [[InlineKeyboardButton(genre, callback_data=genre)] for genre in movies_db.keys()]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    # Отправляем меню только если есть message
    if update.message:
        await update.message.reply_text('Выбери жанр:', reply_markup=reply_markup)
    elif update.callback_query:
        query = update.callback_query
        await query.edit_message_text(text="Выбери жанр:", reply_markup=reply_markup)

# Функция для обработки нажатий на кнопки
async def button(update: Update, context: CallbackContext) -> None:
    """Обрабатывает нажатие на кнопку с жанром."""
    query = update.callback_query
    await query.answer()
    
    genre = query.data  # Получаем выбранный жанр
    movies = movies_db.get(genre, [])  # Получаем список фильмов/сериалов по жанру
    
    if movies:
        response = f"Рекомендации по жанру '{genre}':\n" + "\n".join(f"- {movie}" for movie in movies)
    else:
        response = "По этому жанру ничего не найдено."
    
    await query.edit_message_text(text=response)

# Функция для обработки ошибок
async def error(update: Update, context: CallbackContext) -> None:
    """Логирует ошибки, возникающие в процессе работы."""
    logger.warning('Update "%s" caused error "%s"', update, context.error)

# Основная функция для запуска бота
def main() -> None:
    """Запускает бота."""
    # Токен вашего бота (замените на ваш реальный токен)
    TOKEN = '7820642533:AAHBkcywBpwzH81Er-21h-ZcwtdnoOgUiTo'
    
    application = ApplicationBuilder().token(TOKEN).build()

    # Добавляем обработчики команд
    application.add_handler(CommandHandler("start", start))
    
    # Добавляем обработчик для нажатий на кнопки
    application.add_handler(CallbackQueryHandler(button))
    
    # Добавляем обработчик ошибок
    application.add_error_handler(error)
    
    # Запускаем бота
    application.run_polling()

if __name__== '__main__':
    main()